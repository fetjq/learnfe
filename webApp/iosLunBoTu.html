<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link rel="shortcut icon" href="#">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta content="telephone=no" name="format-detection" />
	<title>IOS轮播图特效</title>
	<link rel="stylesheet" type="text/css" href="css/Reset.css">
	<script src="js/portraitLandscape.js"></script>
	<style>

body{
		overflow: auto;
	}
#picWrap{position: relative;height: 5rem;overflow: hidden;}
#imgUl{
	position: absolute;left: 0;
}
#imgUl li{
	float: left;
}

#imgUl img{
		width: 10.8rem;height: 5rem;
	}



	</style>
	<script>
	// 微型运动框架

function startMove(obj,json,times,fx,fn,fnMove){
	var iCur = {};
	for(var attr in json){
		if(attr == 'opacity'){
			iCur[attr] = Math.round(getStyle(obj,attr)*100);
		}
		else{
			iCur[attr] = parseInt(getStyle(obj,attr));
		}
	}
	
	var startTime = now();
	
	clearInterval(obj.timer);
	obj.timer = setInterval(function(){
		
		var changeTime = now();
		
		var scale = 1 - Math.max(0,(startTime - changeTime + times)/times);
		
		if(fnMove){
			fnMove(scale);
		}
		
		for(var attr in json){
			                
			var value = Tween[fx](scale*times, iCur[attr] , json[attr] - iCur[attr] , times );
			
			if(attr == 'opacity'){
				obj.style.filter = 'alpha(opacity='+ value +')';
				obj.style.opacity = value/100;
			}
			else{
				obj.style[attr] = value + 'px';
			}
			
			if(scale==1){
				clearInterval(obj.timer);
				if(fn){
					fn.call(obj);
				}
			}
			
		}
		
	},13);
	
	function now(){
		return Date.now();
	}
	
}

function getStyle(obj,attr){
	return getComputedStyle(obj,false)[attr];
}

var Tween = {
	linear: function (t, b, c, d){
		return c*t/d + b;
	},
	easeIn: function(t, b, c, d){
		return c*(t/=d)*t + b;
	},
	easeOut: function(t, b, c, d){
		return -c *(t/=d)*(t-2) + b;
	},
	easeBoth: function(t, b, c, d){
		if ((t/=d/2) < 1) {
			return c/2*t*t + b;
		}
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInStrong: function(t, b, c, d){
		return c*(t/=d)*t*t*t + b;
	},
	easeOutStrong: function(t, b, c, d){
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeBothStrong: function(t, b, c, d){
		if ((t/=d/2) < 1) {
			return c/2*t*t*t*t + b;
		}
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	}
}

window.onload=function(){
	var opicWrap=document.getElementById('picWrap');
	var oimgUl=document.getElementById('imgUl');
	var oimgUlLi=oimgUl.getElementsByTagName('li');
	oimgUl.style.width=oimgUlLi[0].offsetWidth*oimgUlLi.length+'px';//设置宽度让其可以滚动
	//阻止默认事件,阻止自带的划屏事件
	function preventDefaultFunc(e){e.preventDefault();};
	var firstTouchPageX=0;//记录初始触摸位置
	var firstLeft=0;//元素的初始left值
	var iNow=0;//记录是第几屏的变量
	var ontouchstartTime=0;

	oimgUl.ontouchstart=function(e){
		var whenLeaveFirstAndGoBackFirstFlag=true;
		ontouchstartTime=new Date().getTime();//记录开始的时间		
		document.addEventListener('touchmove',preventDefaultFunc,false);
		var touches=e.changedTouches[0];
			firstTouchPageX=touches.pageX;
			firstLeft=this.offsetLeft;
			oimgUl.ontouchmove=function(e){
				//在ios划屏效果当中,当滑动到首屏和末尾屏之后再往末端处滑动时,元素跟随手指滑动的速度越来越慢
				var touches=e.changedTouches[0];
				if(this.offsetLeft>=0){//表示在首屏
					if(whenLeaveFirstAndGoBackFirstFlag){
						whenLeaveFirstAndGoBackFirstFlag=false;
						firstTouchPageX=touches.pageX;//这里需要重新获取一下firstTouchPageX的值,以防止出现瞬间的滑动间隙导致不平稳的效果,只重新获取一次即可
					}
				this.style.left=(touches.pageX-firstTouchPageX)/3+'px';//此时不用加上firstLeft,因为firstLeft为0
				}
				else if(this.offsetLeft<=opicWrap.offsetWidth-oimgUl.offsetWidth){
					//-oimgUlLi[0].offsetWidth*(oimgUlLi.length-1)也可以,这时就说明是拉到最后一屏了
				this.style.left=(touches.pageX-firstTouchPageX)/3+(opicWrap.offsetWidth-oimgUl.offsetWidth)+'px';
				}else{
					this.style.left=touches.pageX-firstTouchPageX+firstLeft+'px';
				}
			};
			oimgUl.ontouchend=function(e){
				var touches=e.changedTouches[0];
				//如果他在首屏之后滑动
				if(touches.pageX<firstTouchPageX){//说明向左
						if(firstTouchPageX-touches.pageX>oimgUlLi[0].offsetWidth/2 ||(new Date().getTime()-ontouchstartTime <300 && firstTouchPageX-touches.pageX>30)){//滑动距离大于屏幕一半时才运动;&& firstTouchPageX-touches.pageX>30表示并且不是只是点击一下才滚动
						iNow++;
					//当他快速运动时,也会产生累加的运动

						}
						if(iNow>=oimgUlLi.length){//如果拖到最后一屏了
							iNow=oimgUlLi.length-1;
						}
						startMove(oimgUl,{left:-iNow*oimgUlLi[0].offsetWidth},200,'easeOut');
					//new Date().getTime()  ==> Date.now(); Date.now()为html5获取时间戳的新方法
				}else{//向右
					if(firstTouchPageX-touches.pageX<-oimgUlLi[0].offsetWidth/2||(new Date().getTime()-ontouchstartTime <300 && firstTouchPageX-touches.pageX<-30)){//滑动距离大于屏幕一半时才运动
					iNow--;	
					}
					if(iNow<=0){
						iNow=0;
					}
					startMove(oimgUl,{left:-iNow*oimgUlLi[0].offsetWidth},200,'easeOut');

				};

				this.ontouchmove=null;
				this.ontouchend=null;
				document.removeEventListener('touchmove', preventDefaultFunc,false);//移出阻止默认事件
			}
	}
};




	</script>
</head>
<body>
<section id="picWrap">
<ul id="imgUl">
	<li><a href="javascript:void(0);"><img src="images/ios1.jpg" alt=""></a></li>
	<li><a href="javascript:void(0);"><img src="images/ios2.jpg" alt=""></a></li>
	<li><a href="javascript:void(0);"><img src="images/ios3.jpg" alt=""></a></li>
	<li><a href="javascript:void(0);"><img src="images/ios4.jpg" alt=""></a></li>
	<li><a href="javascript:void(0);"><img src="images/ios5.jpg" alt=""></a></li>
</ul>
</section>

<div style="width: 10.8rem;height: 10rem;background: red;"></div>
<div style="width: 10.8rem;height: 10rem;background: orange;"></div>
<div style="width: 10.8rem;height: 10rem;background: yellow;"></div>
<div style="width: 10.8rem;height: 10rem;background: green;"></div>
</body>
</html>





