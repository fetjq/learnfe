<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link rel="shortcut icon" href="#">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta content="telephone=no" name="format-detection" />
	<title>IOS划屏自动模拟</title>
	<link rel="stylesheet" type="text/css" href="css/Reset.css">
	<script src="js/portraitLandscape.js"></script>
	<style>

body{
		overflow: auto;
	}
#wrap{position: relative;overflow: hidden;height:10rem;border:1px solid green;width: 9rem;margin: 2rem auto;}
#wrapUl{position: absolute;width: 100%;top:0;}
#wrapUl li{
	height: .5rem;border-bottom: 1px solid green;font-size: .3rem
}
#scrollDiv{
	width: .3rem;background: red;border-radius: 10%;position: absolute;top:0;right: .1rem;display: none
}
/*
此需求滚动条的高度为改变,内容越长,滚动条越短,内容越短,滚动条越长
oDiv可视区       滚动条
-----------====---------
oUl的高度       oDiv可视区
所以滚动条*oUl的高度=oDiv*oDiv;


 */

	</style>
	<script>
	// 微型运动框架

function startMove(obj,json,times,fx,fn,fnMove){
	var iCur = {};
	for(var attr in json){
		if(attr == 'opacity'){
			iCur[attr] = Math.round(getStyle(obj,attr)*100);
		}
		else{
			iCur[attr] = parseInt(getStyle(obj,attr));
		}
	}
	
	var startTime = now();
	
	clearInterval(obj.timer);
	obj.timer = setInterval(function(){
		
		var changeTime = now();
		
		var scale = 1 - Math.max(0,(startTime - changeTime + times)/times);
		
		if(fnMove){
			fnMove(scale);
		}
		
		for(var attr in json){
			                
			var value = Tween[fx](scale*times, iCur[attr] , json[attr] - iCur[attr] , times );
			
			if(attr == 'opacity'){
				obj.style.filter = 'alpha(opacity='+ value +')';
				obj.style.opacity = value/100;
			}
			else{
				obj.style[attr] = value + 'px';
			}
			
			if(scale==1){
				clearInterval(obj.timer);
				if(fn){
					fn.call(obj);
				}
			}
			
		}
		
	},13);
	
	function now(){
		return Date.now();
	}
	
}

function getStyle(obj,attr){
	return getComputedStyle(obj,false)[attr];
}

var Tween = {
	linear: function (t, b, c, d){
		return c*t/d + b;
	},
	easeIn: function(t, b, c, d){
		return c*(t/=d)*t + b;
	},
	easeOut: function(t, b, c, d){
		return -c *(t/=d)*(t-2) + b;
	},
	easeBoth: function(t, b, c, d){
		if ((t/=d/2) < 1) {
			return c/2*t*t + b;
		}
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInStrong: function(t, b, c, d){
		return c*(t/=d)*t*t*t + b;
	},
	easeOutStrong: function(t, b, c, d){
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeBothStrong: function(t, b, c, d){
		if ((t/=d/2) < 1) {
			return c/2*t*t*t*t + b;
		}
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	}
}


window.onload=function(){
function preventDefaultEvFunc(e){
	e.preventDefault();
}
	var wrap=document.getElementById('wrap');
	var wrapUl=document.getElementById('wrapUl');
	var divInnerHtml=document.getElementById('divInnerHtml');
	var innerHTMLData='';
	var scrollDiv=document.getElementById('scrollDiv');
	var timer=null;//定时器
	for(var i=0;i<140;i++){
		innerHTMLData+='<li>'+i+'</li>';
	};
	wrapUl.innerHTML=innerHTMLData;
	var scrollDivHeight=wrap.offsetHeight*wrap.offsetHeight/wrapUl.offsetHeight;//根据比例计算滚动条高度
	if(scrollDivHeight<=40){
		scrollDivHeight=40;
	}else if(scrollDivHeight>=wrap.offsetHeight){
		scrollDivHeight=0;
	}//限制滚动条
	scrollDiv.style.height=scrollDivHeight+'px';
	var wrapUlLi=wrapUl.getElementsByTagName('li');
	wrapUl.style.height=wrapUlLi[0].offsetHeight*wrapUlLi.length+'px';//set Height
	var firstTouchPageY=0;//初始触摸位置
	var firstOffsetTop=0;//初始top值
	var startSpeed=0;//初始速度
	var iSpeed=0;//出手一瞬间的速度
	wrapUl.ontouchstart=function(e){
		var flag=true;
		var touches=e.changedTouches[0];
		firstTouchPageY=touches.pageY;
		firstOffsetTop=this.offsetTop;
		startSpeed=touches.pageY;//初始速度变量
		wrapUl.ontouchmove=function(e){
			document.addEventListener('touchmove',preventDefaultEvFunc,false);
			var touches=e.changedTouches[0];
			iSpeed=touches.pageY-startSpeed;
			startSpeed=touches.pageY;//重新赋值初始速度变量
			scrollDiv.style.opacity=1;
			scrollDiv.style.display='block';
			if(this.offsetTop>=0){//到顶部了
				if(flag){
					flag=false;
					firstTouchPageY=touches.pageY;
				}
				this.style.top=(touches.pageY-firstTouchPageY)/3+'px';
				scrollDiv.style.height=scrollDivHeight*(1-this.offsetTop/wrap.offsetHeight)+'px';
				scrollDiv.style.top=0;
		 	}else if(this.offsetTop<=wrap.offsetHeight-wrapUl.offsetHeight){//到底部了
			//-wrapUlLi[0].offsetHeight*(wrapUlLi.length-1);最好用wrap.offsetHeight-wrapUl.offsetHeight,因为当内部数量较多时会导致rem的值计算不准确.
				if(flag){
					flag=false;
					firstTouchPageY=touches.pageY;
				}
			this.style.top=(touches.pageY-firstTouchPageY)/3+(wrap.offsetHeight-wrapUl.offsetHeight)+'px';

			scrollDiv.style.height=scrollDivHeight*(1-Math.abs((this.offsetTop-(wrap.offsetHeight-wrapUl.offsetHeight)))/wrap.offsetHeight)+'px';
				scrollDiv.style.top=wrap.offsetHeight-scrollDiv.offsetHeight+'px';
		}
		else{
			this.style.top=touches.pageY-firstTouchPageY+firstOffsetTop+'px';
			var scrollY=this.offsetTop/(wrap.offsetHeight-wrapUl.offsetHeight);
			scrollDiv.style.top=scrollY*(wrap.offsetHeight-scrollDiv.offsetHeight)+'px';
		}
	};
	wrapUl.ontouchend=function(e){
		document.removeEventListener('touchmove',preventDefaultEvFunc,false);
		var touches=e.changedTouches[0];
		this.ontouchmove=null;
		this.ontouchend=null;
		var This=this;//定时器中改变this指向
		clearInterval(timer);
		timer=setInterval(function(){
				if(Math.abs(iSpeed)<1||This.offsetTop>50||This.offsetTop<=wrap.offsetHeight-wrapUl.offsetHeight-50){
						//说明速度已经很小了
						clearInterval(timer);
						if(This.offsetTop>=0){
							startMove(This,{top:0},400,'easeOut',function(){
								startMove(scrollDiv,{opacity:0},400,'easeOut',function(){
									scrollDiv.style.display='none';
								});
							});
							startMove(scrollDiv,{height:scrollDivHeight},400,'easeOut');
						}else if(This.offsetTop<=wrap.offsetHeight-wrapUl.offsetHeight){
							startMove(This,{top:wrap.offsetHeight-wrapUl.offsetHeight},400,'easeOut',function(){
								startMove(scrollDiv,{opacity:0},400,'easeOut',function(){
									scrollDiv.style.display='none';
								});
							});
							startMove(scrollDiv,{height:scrollDivHeight,top:wrap.offsetHeight-scrollDivHeight},400,'easeOut');
						}else{
							startMove(scrollDiv,{opacity:0},400,'easeOut',function(){
									scrollDiv.style.display='none';
								});
						}
				}else{
					iSpeed*=.95;
					This.style.top=iSpeed+This.offsetTop+'px';
					if(This.offsetTop>=0){
				scrollDiv.style.height=scrollDivHeight*(1-This.offsetTop/wrap.offsetHeight)+'px';
				scrollDiv.style.top=0;
					}
						else if(This.offsetTop<=wrap.offsetHeight-wrapUl.offsetHeight){
	scrollDiv.style.height=scrollDivHeight*(1-Math.abs((This.offsetTop-(wrap.offsetHeight-wrapUl.offsetHeight)))/wrap.offsetHeight)+'px';
				scrollDiv.style.top=wrap.offsetHeight-scrollDiv.offsetHeight+'px';
						}else{
					var scrollY=This.offsetTop/(wrap.offsetHeight-wrapUl.offsetHeight);
					scrollDiv.style.top=scrollY*(wrap.offsetHeight-scrollDiv.offsetHeight)+'px';
						}
				}


		},13);//缓冲运动

	};

	};



	
	


};




	</script>
</head>
<body>
<section id="wrap">
	<ul id="wrapUl">
	</ul>
	<div id="scrollDiv"></div>
</section>
<div style="height: 20rem;width: 100%;background: red" id="divInnerHtml">
	
</div>

</body>
</html>





